# AGENTS - Afilmory é™æ€ç«™ç‚¹ç‰ˆæœ¬

## é¡¹ç›®æ¦‚è¿°

Afilmory æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ç…§ç‰‡å±•ç¤ºç«™ç‚¹ç”Ÿæˆå™¨ï¼Œä¸“æ³¨äºç…§ç‰‡å±•ç¤ºçš„ç”¨æˆ·ä½“éªŒã€‚å®ƒå°†ç…§ç‰‡å¤„ç†å’Œå‰ç«¯æ„å»ºæ•´åˆä¸ºä¸€ä¸ªå®Œæ•´çš„é™æ€ç«™ç‚¹ç”Ÿæˆæµç¨‹ã€‚

## æ ¸å¿ƒç†å¿µ

- **ğŸ“¸ ç…§ç‰‡ä¼˜å…ˆ**: ä¸“æ³¨äºç…§ç‰‡å±•ç¤ºçš„ç”¨æˆ·ä½“éªŒ
- **âš¡ é™æ€ä¼˜å…ˆ**: æ— éœ€æ•°æ®åº“å’Œåç«¯æœåŠ¡å™¨ï¼Œä½¿ç”¨ JSON Manifest ä½œä¸ºæ•°æ®æº
- **ğŸš€ æ˜“äºéƒ¨ç½²**: ä¸“ä¸º Vercel ä¼˜åŒ–ï¼Œæ”¯æŒ S3 å­˜å‚¨
- **ğŸ¨ ç°ä»£è®¾è®¡**: Glassmorphic è®¾è®¡ç³»ç»Ÿï¼ŒReact 19 + Tailwind CSS 4

## æŠ€æœ¯æ¶æ„

### Monorepo ç»“æ„

é¡¹ç›®ä½¿ç”¨ PNPM Workspace ç®¡ç†å¤šåŒ…ç»“æ„ï¼š

- **æ ¹ç›®å½•**: åŒ…å«æ•´ä½“æ„å»ºè„šæœ¬å’Œé…ç½®
- **`apps/web`**: å‰ç«¯ SPA åº”ç”¨ (Vite + React)
- **`packages/builder`**: æ ¸å¿ƒç…§ç‰‡å¤„ç†é€»è¾‘ (Node.js)
- **`packages/data`**: æ•°æ®ç±»å‹å®šä¹‰å’ŒåŠ è½½å™¨
- **`packages/utils`**: é€šç”¨å·¥å…·å‡½æ•° (RSS, Crypto, etc.)
- **`packages/ui`**: UI ç»„ä»¶åº“
- **`packages/webgl-viewer`**: é«˜æ€§èƒ½å›¾ç‰‡æŸ¥çœ‹å™¨
- **`packages/hooks`**: React Hooks

### å…³é”®ä¾èµ–

- **æ„å»ºå·¥å…·**: Vite 7, TypeScript, TSX
- **å‰ç«¯æ¡†æ¶**: React 19, React Router 7
- **æ ·å¼æ–¹æ¡ˆ**: Tailwind CSS 4, DaisyUI 5
- **çŠ¶æ€ç®¡ç†**: Jotai, TanStack Query
- **å›¾ç‰‡å¤„ç†**: Sharp, Heic-to (Node.js)
- **EXIF å¤„ç†**: ExifTool-vendored
- **åœ°å›¾ç»„ä»¶**: MapLibre GL

## æ¨¡å—åŠŸèƒ½è¯¦è§£

### 1. Builder (`@afilmory/builder`)
ç…§ç‰‡å¤„ç†çš„æ ¸å¿ƒå¼•æ“ã€‚
- **èŒè´£**: æ‰«æ S3/æœ¬åœ°ç…§ç‰‡ï¼Œæå– EXIFï¼Œç”Ÿæˆç¼©ç•¥å›¾ï¼Œè®¡ç®— Blurhashï¼Œç”Ÿæˆ `photos-manifest.json`ã€‚
- **å…³é”®æŠ€æœ¯**: 
    - `sharp`: é«˜æ€§èƒ½å›¾ç‰‡å¤„ç†
    - `exiftool-vendored`: å¼ºå¤§çš„ EXIF æ•°æ®æå–
    - `heic-to`: HEIC æ ¼å¼è½¬æ¢

### 2. Data (`@afilmory/data`)
æ•°æ®å±‚æŠ½è±¡ï¼Œä½œä¸ºç±»å‹å®šä¹‰çš„ä¸­å¿ƒã€‚
- **èŒè´£**: å®šä¹‰æ ¸å¿ƒæ•°æ®ç»“æ„ (`PhotoManifestItem`, `PickedExif`) å’Œæä¾›æ•°æ®åŠ è½½é€»è¾‘ã€‚
- **é‡è¦æ€§**: æ‰€æœ‰åŒ…å…±äº«çš„ç±»å‹å®šä¹‰éƒ½åœ¨ `src/types.ts` ä¸­ï¼Œé¿å…äº†å¾ªç¯ä¾èµ–ã€‚

### 3. Utils (`@afilmory/utils`)
é€šç”¨å·¥å…·åº“ã€‚
- **èŒè´£**: æä¾› RSS ç”Ÿæˆã€åŠ å¯†è§£å¯†ã€å¼¹ç°§åŠ¨ç”»ç®—æ³•ç­‰é€šç”¨åŠŸèƒ½ã€‚
- **ä¾èµ–**: ä¾èµ– `@afilmory/data` è·å–ç±»å‹å®šä¹‰ã€‚

### 4. Web (`@afilmory/web`)
ç”¨æˆ·ç›´æ¥äº¤äº’çš„å‰ç«¯åº”ç”¨ã€‚
- **æ„å»º**: è¿™æ˜¯ä¸€ä¸ªçº¯é™æ€ SPAï¼Œæ„å»ºæ—¶æ³¨å…¥ `site.config.ts` é…ç½®ã€‚
- **ç‰¹æ€§**: Masonry å¸ƒå±€ï¼ŒWebGL æŸ¥çœ‹å™¨ï¼ŒPWA æ”¯æŒï¼ŒSSR (SSG) å‹å¥½çš„å…ƒæ•°æ®æ³¨å…¥ã€‚

## è½¯ä»¶å·¥ç¨‹é‡ç‚¹å…³æ³¨ç‚¹

### 1. æ„å»ºæµç¨‹
- **ä¸¤é˜¶æ®µæ„å»º**: 
    1. `pnpm build:manifest`: builder è¿è¡Œï¼Œç”Ÿæˆæ•°æ®ã€‚
    2. `pnpm build:web`: vite è¿è¡Œï¼Œæ‰“åŒ…å‰ç«¯ã€‚
- **å¢é‡æ„å»º**: Builder æ”¯æŒåŸºäº Hash çš„å¢é‡æ›´æ–°ï¼Œé¿å…é‡å¤å¤„ç†ç…§ç‰‡ã€‚

### 2. ç±»å‹å®‰å…¨
- å…¨é¢ä½¿ç”¨ TypeScriptã€‚
- **æ¶æ„**: æ‰€æœ‰å…±äº«ç±»å‹å®šä¹‰é›†ä¸­åœ¨ `@afilmory/data/types`ï¼Œå®ç°äº†ï¼š
  - âœ… ç±»å‹å®šä¹‰å•ä¸€æ¥æº
  - âœ… æ¶ˆé™¤å¾ªç¯ä¾èµ–
  - âœ… æ›´å¥½çš„ç±»å‹å¤ç”¨

### 3. é…ç½®ç®¡ç†
- **ç¯å¢ƒå˜é‡**: `.env` ç”¨äºæ•æ„Ÿä¿¡æ¯ (S3 Keys)ã€‚
- **é™æ€é…ç½®**: `site.config.ts` ç”¨äºç«™ç‚¹å…ƒæ•°æ®ã€‚
- **æ„å»ºæ³¨å…¥**: ç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶æ³¨å…¥åˆ°å‰ç«¯ï¼Œå‰ç«¯è¿è¡Œæ—¶ä¸ä¾èµ– `process.env`ã€‚

### 4. æ€§èƒ½ä¼˜åŒ–
- **å›¾ç‰‡åŠ è½½**: ç¼©ç•¥å›¾ -> é¢„è§ˆå›¾ -> åŸå›¾ (æ¸è¿›å¼åŠ è½½)ã€‚
- **è™šæ‹Ÿæ»šåŠ¨**: ä½¿ç”¨ `masonic` å¤„ç†å¤§é‡ç…§ç‰‡çš„ç€‘å¸ƒæµã€‚
- **WebGL**: ä½¿ç”¨ WebGL åŠ é€Ÿå¤§å›¾æµè§ˆã€‚

## å¿«é€Ÿå¼€å§‹

### å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æœ¬åœ°å¼€å‘ï¼ˆä¸å¤„ç†ç…§ç‰‡ï¼‰
pnpm dev

# å¤„ç†ç…§ç‰‡å¹¶ç”Ÿæˆ manifest
pnpm build:manifest

# æ„å»ºå®Œæ•´é™æ€ç«™ç‚¹ï¼ˆå¤„ç†ç…§ç‰‡ + æ„å»ºå‰ç«¯ï¼‰
pnpm build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm preview
```

### é…ç½®è¯´æ˜

#### 1. S3 å­˜å‚¨é…ç½®
åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼ˆå‚è€ƒ `.env.template`ï¼‰ï¼š
```env
S3_BUCKET_NAME=your-bucket
S3_REGION=us-east-1
S3_ENDPOINT=https://s3.amazonaws.com
S3_ACCESS_KEY_ID=your-key
S3_SECRET_ACCESS_KEY=your-secret
```

#### 2. ç«™ç‚¹é…ç½®
ç¼–è¾‘ `site.config.ts` æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š
```typescript
export const siteConfig: SiteConfig = {
  name: 'æˆ‘çš„ç…§ç‰‡é›†',
  title: 'My Photos',
  description: 'è®°å½•ç”Ÿæ´»',
  url: 'https://your-site.vercel.app',
  author: { name: 'Your Name' }
}
```

### éƒ¨ç½²

**Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰**ï¼š
```bash
# æ–¹å¼ä¸€ï¼šGitHub é›†æˆï¼ˆæ¨èï¼‰
git push origin main

# æ–¹å¼äºŒï¼šCLI éƒ¨ç½²
vercel --prod
```

**æœ¬åœ°æ„å»ºåéƒ¨ç½²**ï¼š
```bash
pnpm build
# è¾“å‡ºåœ¨ apps/web/distï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½•é™æ€æ‰˜ç®¡å¹³å°
```

## å¸¸è§é—®é¢˜

### æ„å»ºæ…¢ï¼Ÿ
- è°ƒæ•´ `builder.config.ts` ä¸­çš„ `defaultConcurrency` å‚æ•°
- åç»­æ„å»ºæ˜¯å¢é‡çš„ï¼Œåªå¤„ç†å˜æ›´çš„ç…§ç‰‡

### ç±»å‹é”™è¯¯ï¼Ÿ
- ç¡®ä¿æ‰€æœ‰åŒ…çš„ä¾èµ–éƒ½å·²å®‰è£…ï¼š`pnpm install`
- ç±»å‹å®šä¹‰åœ¨ `@afilmory/data/types`ï¼Œç”± `exiftool-vendored` æä¾›æ”¯æŒ

## å¾…æ”¹è¿›é¡¹ç›® (æ¶æ„å€º)

1. ~~**ç±»å‹ç»Ÿä¸€**: å°†æ ¸å¿ƒç±»å‹è¿ç§»åˆ° `@afilmory/data`~~ âœ… å·²å®Œæˆ
2. ~~**ä¾èµ–è§£è€¦**: è§£é™¤å¾ªç¯ä¾èµ–~~ âœ… å·²å®Œæˆ
3. **Linting**: ç»Ÿä¸€å„åŒ…çš„ ESLint é…ç½®
